<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=HandheldFriendly content="True">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<meta name=generator content="Hugo 0.90.1">
<link rel=apple-touch-icon sizes=180x180 href=img/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=img/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=img/favicon-16x16.png>
<link rel=manifest href=img/site.webmanifest>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<title>Trust the Certs - The Impatient Software Engineer</title>
<meta name=author content="Prateek">
<meta name=description content="What are x509 certs made of">
<meta property="og:title" content="Trust the Certs">
<meta name=twitter:title content="Trust the Certs">
<meta property="og:type" content="article">
<meta property="og:url" content="https://prateeknischal.github.io/posts/trust-the-certs/"><meta property="og:description" content="What are x509 certs made of">
<meta name=twitter:description content="What are x509 certs made of"><meta property="og:image" content="https://prateeknischal.github.io/img/og.png">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://prateeknischal.github.io/img/og.png"><meta property="article:published_time" content="2021-08-12T01:05:22+05:30"><meta property="article:modified_time" content="2021-08-12T01:05:22+05:30">
<link rel=stylesheet href=https://prateeknischal.github.io/assets/css/fuji.min.css>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-W9Z8MHH4V6')</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W9Z8MHH4V6"></script>
</head>
<body data-theme=dark data-theme-auto=false>
<script data-cfasync=false>var fujiThemeData=localStorage.getItem('fuji_data-theme');fujiThemeData?fujiThemeData!=='auto'&&document.body.setAttribute('data-theme',fujiThemeData==='dark'?'dark':'light'):localStorage.setItem('fuji_data-theme','auto')</script>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W9Z8MHH4V6"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-W9Z8MHH4V6',{anonymize_ip:!1})}</script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-W9Z8MHH4V6','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head>
<main>
<div class="container-lg clearfix">
<div class="col-12 col-md-9 float-left content">
<article>
<h2 class="post-item post-title">
<a href=https://prateeknischal.github.io/posts/trust-the-certs/>Trust the Certs</a>
</h2>
<div class="post-item post-meta">
<span><i class="iconfont icon-today-sharp"></i>&nbsp;2021-08-12</span>
<span><i class="iconfont icon-file-tray-sharp"></i>&nbsp;3232 words</span>
<span><i class="iconfont icon-time-sharp"></i>&nbsp;16 minutes</span>
<span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;No tag</span>
</div>
<div class="post-content markdown-body">
<h2 id=why-do-you-remember-certificates>Why do you remember certificates</h2>
<p>As an IT professional, you might have come across this error while browsing sites of setting up your local development environment.
<img class=img-zoomable src=https://i.imgur.com/aowiN2p.png alt="bad ssl">
</p>
<p>As a fix, you would have been recommended to go to the advanced option in this error and accept the risk and allow the website to work. Your browser may still warn you by displaying the lock on the ominbar of your website as red or unsafe, but you choose to ignore it and not deal with it.</p>
<p>Why do you see this error? Browsers don&rsquo;t do a very good job of explaining the error upfront. Only if you go on the <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target=_blank>Learn more</a> link, you might hope to get some more information about the error. Sometimes it may confuse you more.</p>
<h2 id=what-does-the-above-error-mean>What does the above error mean</h2>
<p>The error message says <code>NET::ERR_CERT_INVALID</code>, but what does that mean. It&rsquo;s doesn&rsquo;t tell what&rsquo;s invalid and why. If you <a href=https://self-signed.badssl.com/ target=_blank>venture more</a> and click on the error, you will be presented with this information.</p>
<pre><code>Subject: *.badssl.com
Issuer: *.badssl.com
Expires on: 9 Oct 2021
Current date: 8 Aug 2021

PEM encoded chain:
-----BEGIN CERTIFICATE-----
MIIDeTCCAmGgAwIBAgIJAPziuikCTox4MA0GCSqGSIb3DQEBCwUAMGIxCzAJBgNV
    ---SNIPPED---
EVA0pmzIzgBg+JIe3PdRy27T0asgQW/F4TY61Yk=
-----END CERTIFICATE-----
</code></pre>
<p>This shows a bunch of information which may not make sense. What is a <code>subject</code>, <code>CERTIFICATE</code>, the gibberish between the markers?</p>
<h2 id=how-is-information-protected-on-the-internet>How is information protected on the internet</h2>
<p>Internet in the early days was open for anyone to view and by that I mean, anyone could read the communication between 2 parties. This is not ok when you are transferring sensitive information, something like bank transactions. To safeguard the traffic on the wire, we started to encrypt the traffic which could only be decrypted by the 2 communicating parties. In order to <a href=https://en.wikipedia.org/wiki/Encryption target=_blank>encrypt</a> the information, we need some secret that is known only to the involved parties. Actually there are some requirements that you should look for</p>
<ul>
<li>Two parties could talk securely over and insecure channel</li>
<li>Both the parties could identify and verify each other</li>
</ul>
<h2 id=enters-asymmetric-encryption>Enters Asymmetric encryption</h2>
<p>Asymmetric encryption is a scheme involving a key which consists of 2 parts, a public and a private part. The private part should be protected by the owner and the public part can be distributed to everyone. A public key can be used to encrypt information which can only be decrypted by the corresponding private key.</p>
<p>Now everyone can have their own key pairs and use it to share information on an insecure channel. If Alice wants to share information with Bob, Alice can encrypt is using Bob&rsquo;s public key and send it over the wire and only Bob could use his private key to decrypt it and make sense of it. This solves the first requirement.</p>
<p>This constitues <a href=https://en.wikipedia.org/wiki/Public-key_cryptography target=_blank>Public key cryptography</a> which provided 2 features</p>
<ul>
<li>Public key encryption - Encryption happens using a public key (available to all) and decryption happens using a private key (owned by a single entity).</li>
<li>Digital signature - A methematically proven method to prove ownership of the private key without exposing anything.</li>
</ul>
<p>There is still a problem, they haven&rsquo;t shared or proven their identity, which means, Alice is sharing information securely with <em>someone</em>. There is no way to prove that it&rsquo;s Bob unless they are aware of each other&rsquo;s public keys before hand which is not practical when there are so many people to talk to.</p>
<p>This problem is <em>managed</em> by the <a href=https://en.wikipedia.org/wiki/Public_key_infrastructure target=_blank>Public Key Infrastructure</a>. It allows to put identity to public keys.</p>
<h2 id=public-key-infrastructure>Public Key Infrastructure</h2>
<p>Public key infrastructure is a system of vetting a public keys by a trusted third party. For example, between Alice, Bob and Charlie, if both Alice and Bob trust Charlie, they are going to trust Charlie&rsquo;s word on which public keys belong to whom. Charlie here will be termed as a <a href=https://en.wikipedia.org/wiki/Certificate_authority target=_blank>Certificate Authority</a> or an <strong>Issuer</strong> in this context.</p>
<p>Technically it&rsquo;s a chicken an egg problem, how do you trust Charlie without meeting them. But that&rsquo;s a topic for another day.</p>
<h2 id=back-to-the-original-problem>Back to the original problem</h2>
<p>Notice the error message on the image, It says,</p>
<pre><code>Subject: *.badssl.com
Issuer: *.badssl.com
</code></pre>
<p>Chrome does not <strong>trust</strong> <code>*.badssl.com</code> as an <strong>Issuer</strong>, so it&rsquo;s not going to trust anything vetted by it and hence is rejecting the connection.</p>
<h2 id=whats-that-strange-blob-of-text-below-it>What&rsquo;s that strange blob of text below it</h2>
<p>PKI provides a way to attach an identity to a public key. But how does it do that? Remember how the is a common trusted third party. The third party <em>digitally signs</em> the identity of the private key holder and their public key and distributes it to everyone who wants it.</p>
<p>The <code>CERTIFICATE</code> is a public document to identify the owner of the private part of the public key. You may choose to trust or not trust the third party who is vouching for this certification.</p>
<p>Into the weeds, how do we actually make sense of the strange blob. Here&rsquo;s how</p>
<pre><code>echo &quot;-----BEGIN CERTIFICATE-----
MIIDeTCCAmGgAwIBAgIJAPziuikCTox4MA0GCSqGSIb3DQEBCwUAMGIxCzAJBgNV
BAYTAlVTMRMwEQYDVQQIDApDYWxpZm9ybmlhMRYwFAYDVQQHDA1TYW4gRnJhbmNp
c2NvMQ8wDQYDVQQKDAZCYWRTU0wxFTATBgNVBAMMDCouYmFkc3NsLmNvbTAeFw0x
OTEwMDkyMzQxNTJaFw0yMTEwMDgyMzQxNTJaMGIxCzAJBgNVBAYTAlVTMRMwEQYD
VQQIDApDYWxpZm9ybmlhMRYwFAYDVQQHDA1TYW4gRnJhbmNpc2NvMQ8wDQYDVQQK
DAZCYWRTU0wxFTATBgNVBAMMDCouYmFkc3NsLmNvbTCCASIwDQYJKoZIhvcNAQEB
BQADggEPADCCAQoCggEBAMIE7PiM7gTCs9hQ1XBYzJMY61yoaEmwIrX5lZ6xKyx2
PmzAS2BMTOqytMAPgLaw+XLJhgL5XEFdEyt/ccRLvOmULlA3pmccYYz2QULFRtMW
hyefdOsKnRFSJiFzbIRMeVXk0WvoBj1IFVKtsyjbqv9u/2CVSndrOfEk0TG23U3A
xPxTuW1CrbV8/q71FdIzSOciccfCFHpsKOo3St/qbLVytH5aohbcabFXRNsKEqve
ww9HdFxBIuGa+RuT5q0iBikusbpJHAwnnqP7i/dAcgCskgjZjFeEU4EFy+b+a1SY
QCeFxxC7c3DvaRhBB0VVfPlkPz0sw6l865MaTIbRyoUCAwEAAaMyMDAwCQYDVR0T
BAIwADAjBgNVHREEHDAaggwqLmJhZHNzbC5jb22CCmJhZHNzbC5jb20wDQYJKoZI
hvcNAQELBQADggEBAGlwCdbPxflZfYOaukZGCaxYK6gpincX4Lla4Ui2WdeQxE95
w7fChXvP3YkE3UYUE7mupZ0eg4ZILr/A0e7JQDsgIu/SRTUE0domCKgPZ8v99k3A
vka4LpLK51jHJJK7EFgo3ca2nldd97GM0MU41xHFk8qaK1tWJkfrrfcGwDJ4GQPI
iLlm6i0yHq1Qg1RypAXJy5dTlRXlCLd8ufWhhiwW0W75Va5AEnJuqpQrKwl3KQVe
wGj67WWRgLfSr+4QG1mNvCZb2CkjZWmxkGPuoP40/y7Yu5OFqxP5tAjj4YixCYTW
EVA0pmzIzgBg+JIe3PdRy27T0asgQW/F4TY61Yk=
-----END CERTIFICATE-----&quot; | openssl x509 -noout -text
</code></pre>
<p>The above command dumps the following information</p>
<pre><code>Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 18222331727589575800 (0xfce2ba29024e8c78)
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: C=US, ST=California, L=San Francisco, O=BadSSL, CN=*.badssl.com
        Validity
            Not Before: Oct  9 23:41:52 2019 GMT
            Not After : Oct  8 23:41:52 2021 GMT
        Subject: C=US, ST=California, L=San Francisco, O=BadSSL, CN=*.badssl.com
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:c2:04:ec:f8:8c:ee:04:c2:b3:d8:50:d5:70:58:
                        ---SNIPPED---
                    7c:f9:64:3f:3d:2c:c3:a9:7c:eb:93:1a:4c:86:d1:
                    ca:85
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Basic Constraints:
                CA:FALSE
            X509v3 Subject Alternative Name:
                DNS:*.badssl.com, DNS:badssl.com
    Signature Algorithm: sha256WithRSAEncryption
         69:70:09:d6:cf:c5:f9:59:7d:83:9a:ba:46:46:09:ac:58:2b:
             ---SNIPPED---
         00:60:f8:92:1e:dc:f7:51:cb:6e:d3:d1:ab:20:41:6f:c5:e1:
         36:3a:d5:89
</code></pre>
<p>Notice the following things</p>
<ul>
<li>Serial Number: The unique identifier for the certificate with the issuer</li>
<li>Issuer: The identity of who vetted the public key</li>
<li>Subject: The identity of how owns the private key</li>
<li>Subject Public key: The actual public key which is vetted</li>
<li>Signature Algorithm: The algorithm used to sign the identity and public key information</li>
<li>Validity: The dates for which this identity is considered valid</li>
</ul>
<p>This is an <a href=https://en.wikipedia.org/wiki/RSA_%28cryptosystem%29 target=_blank>RSA</a> keypair. So the public key has a Modulus and an Exponent. These values can be use to encrypt a message.</p>
<p>The signature Algorithm is the algorithm used to <em>digitally sign</em> the information in the certificate so that anyone can verify the validity of the certificate. This verification is done by the public key of the Issuer or the trusted third party who we already trust.</p>
<h2 id=how-does-a-trusted-certificate-look-like>How does a trusted certificate look like</h2>
<p>The certificate above is a certificate that I don&rsquo;t trust, but how does a certificate look like that I trust. Let&rsquo;s see what <a href=http://www.google.com target=_blank>www.google.com</a> presents when we try to connect to it.</p>
<pre><code>echo | openssl s_client -connect www.google.com:443 2&gt;/dev/null \
     | openssl x509 -noout -text
</code></pre>
<p>This looks something like</p>
<pre><code>Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            3a:6a:c0:d8:53:c9:8f:f1:0a:00:00:00:00:f2:c8:bb
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: C=US, O=Google Trust Services LLC, CN=GTS CA 1C3
        Validity
            Not Before: Jul 12 03:48:05 2021 GMT
            Not After : Oct  4 03:48:04 2021 GMT
        Subject: CN=www.google.com
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:b5:87:a3:12:1a:60:3d:6f:74:f1:33:0f:67:60:
                        ---SNIPPED--
                    11:3e:1f:ba:8b:59:d9:e8:6c:a0:6c:3e:07:31:e9:
                    56:bb
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Extended Key Usage:
                TLS Web Server Authentication
            X509v3 Basic Constraints: critical
                CA:FALSE
            X509v3 Subject Key Identifier:
                2D:42:0A:99:66:0A:65:08:C7:B4:59:B8:23:55:13:FA:A2:D1:A2:01
            X509v3 Authority Key Identifier:
                keyid:8A:74:7F:AF:85:CD:EE:95:CD:3D:9C:D0:E2:46:14:F3:71:35:1D:27

            Authority Information Access:
                OCSP - URI:http://ocsp.pki.goog/gts1c3
                CA Issuers - URI:http://pki.goog/repo/certs/gts1c3.der

            X509v3 Subject Alternative Name:
                DNS:www.google.com
            X509v3 Certificate Policies:
                Policy: 2.23.140.1.2.1
                Policy: 1.3.6.1.4.1.11129.2.5.3

            X509v3 CRL Distribution Points:

                Full Name:
                  URI:http://crls.pki.goog/gts1c3/fVJxbV-Ktmk.crl

            1.3.6.1.4.1.11129.2.4.2:
                ......u.\.C....ED.^..V..7...G..s..^........z..4=.....F0D..
..4.8...xK.].rk.....o.R
..^.T%.S..vt11..v..\./.w0&quot;.T..0.V..M..3.../ ..N.d....z..3......G0E. ...|..Y...R2.......k...+.....8.p.!..SF...+.o..').D.........mc....(A
    Signature Algorithm: sha256WithRSAEncryption
         d7:9f:97:e8:2a:5c:bc:04:9d:51:9d:ab:d4:9b:b0:cd:71:b5:
            ---SNIPPED---
         45:b0:52:39
</code></pre>
<p>This certificate has a lot more information about the the <code>Subject</code> and what this key is allowed to do.</p>
<h2 id=a-scary-view-of-the-certificate>A scary view of the certificate</h2>
<p>Try the following commands</p>
<pre><code class="language-bash=">echo | openssl s_client -connect www.google.com:443 2&gt;/dev/null \
     | openssl x509 \
     | openssl asn1parse -i

echo | openssl s_client -connect www.google.com:443 2&gt;/dev/null \
     | openssl x509 \
     | openssl asn1parse -i -strparse 196
</code></pre>
<p>Look for interesting stuff in the output!</p>
<p>Now that we know how the certificate look and what does it contain, let&rsquo;s see how to use it for a local development environment.</p>
<h2 id=using-certificates-in-a-local-development-environment>Using certificates in a local development environment</h2>
<p>Using self signed certificates can be a pain for 2 reasons</p>
<ul>
<li>There can be a lot depding on what domains you are issuing them for</li>
<li>You will have to deal with pesky errors from browsers and clients setting to ignore SSL verification everywhere which isn&rsquo;t ideal.</li>
</ul>
<p>Since you control your development environment and is confined to your development environment, why not just become the <strong>Certificate Authority</strong> and use it to issue all your dev certificates. You trust just one certificate once and any certificate issued by that third party (which is you) is automatically trusted by your clients.</p>
<p>Ok, easier said than. How do I issue my own Certificate Authority.</p>
<blockquote>
<p>As they say, Hold my beer!</p>
</blockquote>
<p>Note: If you want to follow along, then you will require <a href=https://golang.org/dl/ target=_blank>Golang</a> version 1.12 or above.</p>
<pre><code class="language-bash="># Assuming you have Golang installed

git clone https://github.com/square/certstrap
cd certstrap
go build

# create a directory for your binaries, useful for other stuff as well
mkdir &quot;$HOME/.bin&quot;
mv certstrap &quot;$HOME/.bin/certstrap&quot;

# put certstrap in the PATH
export PATH=&quot;$PATH:$HOME/.bin&quot;

certstrap --version
</code></pre>
<p>If your package manager has certstrap, it&rsquo;s even simpler. And that&rsquo;s it, you are good to issue certificates</p>
<h2 id=generate-your-certificate-authority>Generate your Certificate authority</h2>
<pre><code class="language-bash=">certstrap init --common-name domain.com \
    --organization Domain \
    --organizational-unit AllThingsSecure \
    --country IN \
    --province KA
</code></pre>
<p>Enter the passphrase prompted. You always want to protect your CAs because it will essentially become a trusted certificate and if this leaks, bad things can happen to you, like impersonating Gmail or your banks! Be careful!!</p>
<p>The above command should dump out 3 files</p>
<pre><code>Created out/domain.com.key
Created out/domain.com.crt
Created out/domain.com.crl
</code></pre>
<p>These are your Key, Certificate and Certificate Revocation List (used to revoke certificates issued by this CA if you choose to, basically to say that I no longer vet a particular certificate).</p>
<h2 id=issue-your-first-certificate>Issue your first certificate</h2>
<p>Once your CA is issued, you can use it issue a certificate.</p>
<pre><code class="language-bash=">certstrap request-cert \
    --common-name foo.domain.com \
    --domain foo.domain.com,bar.domain.com \
    --country IN --organization Domain --organizational-unit NewTeam
</code></pre>
<p><strong>Note</strong>: Make sure to have the Common Name in the <code>--domain</code> flag since Chrome will reject if the CN is not part of the SAN attributes as <a href=https://myarch.com/mandatory-certificate-extensions/ target=_blank>browsers no longer trust the CN field alone</a>.</p>
<p>The above command is going to generate 2 files.</p>
<pre><code>Created out/foo.domain.com.key
Created out/foo.domain.com.csr
</code></pre>
<p>One of them is an RSA private key and the other is a CSR or a Certificate Signing Request. This is like a form you fill up and ask the Certificate Authority to certify. A real CA may do it&rsquo;s own verification to make sure the information is correct. In this case, since we are the CA, we know it&rsquo;s trustworthy. So, we certify by signing it using the CA key like below</p>
<pre><code class="language-bash=">certstrap sign foo.domain.com \
    --CA domain.com \
    --expires &quot;3 months&quot;
    --csr out/foo.domain.com.csr
</code></pre>
<p>Answer all the password prompts, and there you have it, your certificate. You ideally want to issue short lived certificates for dev usage but you can issue for a longer duration but not longer than <a href=https://support.globalsign.com/ssl/general-ssl/397-day-maximum-tls-certificate-validity target=_blank>397 days</a>. You generate the CA once and then use the <code>request-cert</code> and <code>sign</code> step to generate as many certs you want.</p>
<h3 id=what-if-i-need-more-info-in-the-certficiate>What if I need more info in the certficiate</h3>
<p>This is a very simple way to generate certificates. This is likely sufficient for a local web development environment but if you have complicated needs which require different attributes, encoding addition and custom information, you are likely going to need a better way. <a href=https://jamielinux.com/docs/openssl-certificate-authority/ target=_blank>openssl certificate authority</a> is an excellent resource to build you certificates with all the knobs exposed.</p>
<h2 id=make-your-system-trust-your-ca>Make your system trust your CA</h2>
<p>All operating systems have a default list of certificates that it trusts, they are usually very well known and trusted CAs. The browser and clients can either refer to the Operating system list for trusting CAs or have their own list. For example,</p>
<ul>
<li>Chrome uses the system default list</li>
<li>Firefox has its own list</li>
<li>NodeJS has it&rsquo;s own list and for any new CAs it uses the file pointed by <code>NODE_EXTRA_CA_CERTS</code>.</li>
</ul>
<p>You can refer to your platform documentation, on how to import/add a new trusted certificate. For MacOS, it&rsquo;s pretty straight forward, just add it in the <code>Keychain Access</code> application in the <code>System</code> list. For Linux, refer to the man page for <a href=https://manpages.ubuntu.com/manpages/xenial/man8/update-ca-certificates.8.html target=_blank><code>update-ca-certificates</code></a> utility.</p>
<p>Windows users are on their own!</p>
<p>Once you have the CA added, all of your applications should trust all certificates issued by your CA.</p>
<h2 id=the-issuer-heirarchy>The issuer heirarchy</h2>
<p>As mentioned, in general CA keys are kept in a highly secure location with no access to the network. They are usually valid for more than 10 years which means loosing them would cause a huge chaos. How do we then use it to issue certificates. To solve this problem, other certificates are issued called <strong>Issuers</strong> which are valid for a smaller time duration and are allowed to issue other <strong>Issuers</strong> or certificates called <strong>leaf</strong> certificates as they are no longer allowed to issue other certs, so last in the tree of certs or the leaf.</p>
<pre><code class="language-bash=">echo | openssl s_client -connect google.com:443 &gt;/dev/null
</code></pre>
<p>produces,</p>
<pre><code>depth=3 C = BE, O = GlobalSign nv-sa, OU = Root CA, CN = GlobalSign Root CA
verify return:1
depth=2 C = US, O = Google Trust Services LLC, CN = GTS Root R1
verify return:1
depth=1 C = US, O = Google Trust Services LLC, CN = GTS CA 1C3
verify return:1
depth=0 CN = *.google.com
verify return:1
DONE
</code></pre>
<p>Notice how the server presents 4 certificates,</p>
<ul>
<li><code>C = BE, O = GlobalSign nv-sa, OU = Root CA, CN = GlobalSign Root CA</code> The Root CA</li>
<li><code>C = US, O = Google Trust Services LLC, CN = GTS Root R1</code> an intermediate issuer CA</li>
<li><code>C = US, O = Google Trust Services LLC, CN = GTS CA 1C3</code> another layer of intermediate issuer CA</li>
<li><code>CN = *.google.com</code> the final leaf certificate for the server</li>
</ul>
<h2 id=what-does-a-certificate-contain>What does a certificate contain</h2>
<p>Now that you have seen how to make a simple certificate chain, let&rsquo;s see what each item in a sample certificate mean.
Looking at the <a href=http://www.google.com target=_blank>www.google.com</a> certificate,</p>
<ul>
<li><strong>Version</strong> denotes the certificate structure, version 3 is the <a href=https://en.wikipedia.org/wiki/X.509 target=_blank><code>x509v3</code></a> type of certificate.</li>
<li><strong>Serial Number</strong> notes the unique identifier for the certificate. This can be same for 2 different issuers but can&rsquo;t be same for any 2 certificate for a single issuer.</li>
<li><strong>Signature Algorithm</strong> defines what algorithm is used to digitally sign the data in the certificate by the Issuer. <code>sha256WithRSAEncryption</code> means that the data was hashed using <code>SHA256</code> and then encrypted using the private key of the issuer (the signature scheme uses private key for &ldquo;encryption&rdquo; instead of the public key like in the standard encryption scheme).</li>
<li><strong>Issuer</strong> defines the fully qualified name of the Issuer of the certificate. Usually a CA does not use it&rsquo;s root private key for any operation, it will issue a group of <code>Issuer</code> certificates which are allowed to sign other certificates for practical considerations. The CA private keys are kept under the highest security off the network.</li>
<li><strong>Validity</strong> defines the time period for which this certificate is valid, beyond this, the certificate should not be trusted.</li>
<li><strong>Subject</strong> defines the fully qualified descriptor of the identity who is claiming to be the owner of the private part of the public key in the certificate.</li>
<li><strong>Subject Public Key Info</strong> defines what algorithm and respective values are representing the key. The algorithm is <code>rsaEncryption</code> which contains of a modulus and an exponent. Refer the Wiki article about RSA key pair.</li>
<li><strong>X509v3</strong> extensions represent what a particular certificate is allowed to do. For example
<ul>
<li>
<p><strong>X509v3 Key Usage</strong>, a critical extension which should be strictly adhered to. It&rsquo;s allowed to do <code>Digital Signature</code> (allowed to sign some data digitally), <code>Key Encipherment</code> (encrypt other keys not part of the application, like in TLS)</p>
</li>
<li>
<p><strong>X509v3 Extended Key Usage</strong> allows this certificate to be used as a <code>TLS Web Server Authentication</code>, which is this certificate can be used to represent a client&rsquo;s identity during a TLS connection</p>
</li>
<li>
<p><strong>X509v3 Basic Constraints</strong>, a critical extension, says, this certificate <strong>should not</strong> be considered as a <code>CA</code> or a certificate authority.</p>
</li>
<li>
<p><strong>X509v3 Subject Key Identifier</strong> defines identity of the private key. Certificates expire, which means, a new key pair can represent the same identity, so the private keys are differentiated by this value.</p>
</li>
<li>
<p><strong>Authority Key Identifier</strong> defines the identity of the private key of the signer which vetted this certificate.</p>
</li>
<li>
<p><strong>Authority Information Access</strong> tells locations on the internet where to find more information about the issuer.</p>
<ul>
<li><strong>OCSP</strong> or Online Certificate Status Protocol is a protocol that allows a client to check if the certificate which is presented is actually valid and not revoked</li>
<li><strong>CA Issuers</strong> has the information about the issuer certificate if it&rsquo;s not bundled with this certificate. This can be handy to verify the certificate to the root CA
<pre><code class="language-bash=">curl http://pki.goog/repo/certs/gts1c3.der -o - \
    | openssl x509 -inform DER -noout -text
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>X509v3 Subject Alternative Name</strong>, in case this certificate is used to serve a TLS request against a domain or DNS name, what DNS names can be represented by this certificate. So, if the DNS names contain foo.google.com and bar.google.com, the certificate will be allowed to represent those domains. But, if this certificate is presented during a request with facebook.com, the client will reject it because it&rsquo;s not part of the DNS names.</p>
</li>
<li>
<p><strong>X509v3 Certificate Policies</strong> is a set of addition (possibly custom) policies which may be enforced on this certificate. Note that it doesn&rsquo;t have an &ldquo;readable&rdquo; name. This could signify that it&rsquo;s a non-standard attribute not known to the generic public client and may be ignored.</p>
<ul>
<li><a href=https://oidref.com/2.23.140.1.2.1 target=_blank><code>2.23.140.1.2.1</code></a> denotes
<blockquote>
<p>Use of this OID is appropriate when the certificate lacks information about the certificate holder&rsquo;s legal identity.</p>
</blockquote>
</li>
<li><code>1.3.6.1.4.1.11129.2.5.3</code> seems to be a custom value, still part of google(11129) though.</li>
</ul>
</li>
<li>
<p><strong>X509v3 CRL distribution Points</strong>, a CA may want to say that these certificate (issuers or leaf certificates) are no longer valid because of some issue other than expiry. That information is encoded in a <em>Certificate Revocation List</em> which is published by each CA and should be checked by a client if possible to make sure it&rsquo;s trusting a valid certificate.</p>
<pre><code class="language-bash=">curl http://crls.pki.goog/gts1c3/fVJxbV-Ktmk.crl -o - \
    | openssl crl -inform DER -noout -text
</code></pre>
<p>Notice how this literally has a list of Serial Numbers of the certs that will be no longer valid after the <code>Revocation Date</code>.</p>
</li>
<li>
<p><a href=https://oidref.com/1.3.6.1.4.1.11129.2.4.2 target=_blank><code>1.3.6.1.4.1.11129.2.4.2</code></a>, Eh? what&rsquo;s this. This is a custom (non-standard) attribute represnted in an OID format. This OID refers to</p>
<pre><code>{
    iso(1)
    identified-organization(3)
    dod(6)
    internet(1)
    private(4)
    enterprise(1)
    google(11129)
    2(2) 4(4) 2(2)
}
</code></pre>
</li>
</ul>
</li>
<li><strong>Signature Algorithm</strong> this time defines what signature algorithm is used and what is it&rsquo;s value.</li>
</ul>
<p>This by no means is an exhaustive list of what can a certificate contain. In theory, a certificate is just a container and can contain any information you like. For a simple local development use case, this article should take you far enough to not worry about it later.</p>
<p>For any usecase that requires exposing your applications over the public internet or with a large group of people, I would highly recommend to use a more &ldquo;professional&rdquo; and battle tested CA. Some of them are</p>
<ul>
<li><a href=https://letsencrypt.org/ target=_blank>Let&rsquo;s Encrypt</a> the most popular production-ready and free CA</li>
<li><a href=https://github.com/cloudflare/cfssl target=_blank>Cloudflare cfssl</a> an opensource CA which could be ideal for a staging style scenario</li>
<li>Then there are always native CAs for the cloud environment like the <a href=https://aws.amazon.com/certificate-manager/private-certificate-authority/ target=_blank>Amazon CA</a>, <a href=https://pki.goog/ target=_blank>Google Trust Services</a>, <a href=https://www.globalsign.com/en-in target=_blank>Global Sign</a> and many more.</li>
</ul>
<p>Discussion thread
<a href=https://www.reddit.com/r/cybersecurity/comments/p47kza/what_are_certificates_made_of_the_noob_version/ target=_blank>here</a></p>
</div>
</article>
<div class="license markdown-body">
<blockquote>
<p>Unless otherwise noted, the content of this site is licensed under <a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a>.</p>
</blockquote>
</div>
</div>
<aside class="col-12 col-md-3 float-left sidebar">
<div class="sidebar-item sidebar-pages">
<h3>Pages</h3>
<ul>
<li>
<a href=/posts>Home</a>
</li>
<li>
<a href=/about/>About</a>
</li>
<li>
<a href=/index.xml>RSS</a>
</li>
</ul>
</div>
<div class="sidebar-item sidebar-links">
<h3>Links</h3>
<ul>
<li>
<a href=https://github.com/prateeknischal target=_blank><span>GitHub</span></a>
</li>
<li>
<a href=https://twitter.com/pikaynu target=_blank><span>Twitter</span></a>
</li>
</ul>
</div>
<div class="sidebar-item sidebar-tags">
<h3>Tags</h3>
<div>
</div>
</div>
<div class="sidebar-item sidebar-toc">
<h3>Table of Contents</h3><nav id=TableOfContents>
<ul>
<li><a href=#why-do-you-remember-certificates>Why do you remember certificates</a></li>
<li><a href=#what-does-the-above-error-mean>What does the above error mean</a></li>
<li><a href=#how-is-information-protected-on-the-internet>How is information protected on the internet</a></li>
<li><a href=#enters-asymmetric-encryption>Enters Asymmetric encryption</a></li>
<li><a href=#public-key-infrastructure>Public Key Infrastructure</a></li>
<li><a href=#back-to-the-original-problem>Back to the original problem</a></li>
<li><a href=#whats-that-strange-blob-of-text-below-it>What&rsquo;s that strange blob of text below it</a></li>
<li><a href=#how-does-a-trusted-certificate-look-like>How does a trusted certificate look like</a></li>
<li><a href=#a-scary-view-of-the-certificate>A scary view of the certificate</a></li>
<li><a href=#using-certificates-in-a-local-development-environment>Using certificates in a local development environment</a></li>
<li><a href=#generate-your-certificate-authority>Generate your Certificate authority</a></li>
<li><a href=#issue-your-first-certificate>Issue your first certificate</a>
<ul>
<li><a href=#what-if-i-need-more-info-in-the-certficiate>What if I need more info in the certficiate</a></li>
</ul>
</li>
<li><a href=#make-your-system-trust-your-ca>Make your system trust your CA</a></li>
<li><a href=#the-issuer-heirarchy>The issuer heirarchy</a></li>
<li><a href=#what-does-a-certificate-contain>What does a certificate contain</a></li>
</ul>
</nav></div>
</aside>
</div>
<div class=btn>
<div class=btn-menu id=btn-menu>
<i class="iconfont icon-grid-sharp"></i>
</div>
<div class=btn-toggle-mode>
<i class="iconfont icon-contrast-sharp"></i>
</div>
<div class=btn-scroll-top>
<i class="iconfont icon-chevron-up-circle-sharp"></i>
</div>
</div>
<aside class=sidebar-mobile style=display:none>
<div class=sidebar-wrapper>
<div class="sidebar-item sidebar-pages">
<h3>Pages</h3>
<ul>
<li>
<a href=/posts>Home</a>
</li>
<li>
<a href=/about/>About</a>
</li>
<li>
<a href=/index.xml>RSS</a>
</li>
</ul>
</div>
<div class="sidebar-item sidebar-links">
<h3>Links</h3>
<ul>
<li>
<a href=https://github.com/prateeknischal target=_blank><span>GitHub</span></a>
</li>
<li>
<a href=https://twitter.com/pikaynu target=_blank><span>Twitter</span></a>
</li>
</ul>
</div>
<div class="sidebar-item sidebar-tags">
<h3>Tags</h3>
<div>
</div>
</div>
<div class="sidebar-item sidebar-toc">
<h3>Table of Contents</h3>
<nav id=TableOfContents>
<ul>
<li><a href=#why-do-you-remember-certificates>Why do you remember certificates</a></li>
<li><a href=#what-does-the-above-error-mean>What does the above error mean</a></li>
<li><a href=#how-is-information-protected-on-the-internet>How is information protected on the internet</a></li>
<li><a href=#enters-asymmetric-encryption>Enters Asymmetric encryption</a></li>
<li><a href=#public-key-infrastructure>Public Key Infrastructure</a></li>
<li><a href=#back-to-the-original-problem>Back to the original problem</a></li>
<li><a href=#whats-that-strange-blob-of-text-below-it>What&rsquo;s that strange blob of text below it</a></li>
<li><a href=#how-does-a-trusted-certificate-look-like>How does a trusted certificate look like</a></li>
<li><a href=#a-scary-view-of-the-certificate>A scary view of the certificate</a></li>
<li><a href=#using-certificates-in-a-local-development-environment>Using certificates in a local development environment</a></li>
<li><a href=#generate-your-certificate-authority>Generate your Certificate authority</a></li>
<li><a href=#issue-your-first-certificate>Issue your first certificate</a>
<ul>
<li><a href=#what-if-i-need-more-info-in-the-certficiate>What if I need more info in the certficiate</a></li>
</ul>
</li>
<li><a href=#make-your-system-trust-your-ca>Make your system trust your CA</a></li>
<li><a href=#the-issuer-heirarchy>The issuer heirarchy</a></li>
<li><a href=#what-does-a-certificate-contain>What does a certificate contain</a></li>
</ul>
</nav>
</div>
</div>
</aside>
</main>
<footer>
<div class="container-lg clearfix">
<div class="col-12 footer">
<span>&copy; 2020-2021
<a href=https://prateeknischal.github.io>Prateek</a>
| <a href=https://github.com/prateeknischal/prateeknischal.github.io>Source code</a>
| Powered by <a href=https://github.com/dsrkafuu/hugo-theme-fuji/ target=_blank>Fuji-v2</a> & <a href=https://gohugo.io/ target=_blank>Hugo</a>
</span>
</div>
</div>
</footer>
<script defer src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-core.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js></script>
<script defer src=/assets/js/fuji.min.js></script>
</body>
</html>